"use strict";!function(n,t){var o=function(){},e=function(){function t(e){{var r=e.$main,i=void 0===r?n():r,c=e.$style;void 0===c?n():c}this.init=function(){};var a=function(t){var o,e,r,c;return t=t||i,c=l(),o=function(){},r=function(o,e){var r,i,a;return r=n(o),r.length?(a=r.css(e),i=a,u.isColor(i)&&(u.isHexColor(i)||(i=u.RGBToHex(i),""===i&&(i="rgba(0, 0, 0, 0)"===a?c.isWriteTransparent(t.find("input").data("selector"))?"transparent":"":a)))):i="",i},e=function(n){void 0===n&&(n=!0);var o,e,i,c,a;if(o=t.find("input"),e=o.data("selector"),i=e.match(/^(.*?)[,|{]/),i=i&&i[1],c=e.match(/{([^:]*?)\:/),c=c&&c[1],i&&c){("background"==c||"border"==c)&&(c+="-color"),a=r(i,c)||o.val(),t.css("backgroundColor",a),n?o.val(a):o.data("pickingColor",a);var s=o.eq(0),l=s.next(".txt-tips");l.length||(s.after('<div class="txt-tips"></div>'),l=s.next(".txt-tips")),l.html(a||"")}},{refresh:o,setFn:e}},s=function(t){var e,r,i;return e=function(){var e=t.farbtastic(function(n){o(n)});return n.farbtastic(e)},r=function(){return n.farbtastic(t)},i=function(n){o=n},{create:e,refreshCallback:i,getFn:r}},l=function(){var t,o,e,r,c,a,s,l,p,u;t="";var f;return f=n("style#colorcustom"),a=function(){var t=n("head").find("style#DesignCss");t.remove()},l=function(){var t,o;return t=n("head").find("style#DesignCss"),o=t.length?t.html().replace(/[\n|\r\n|\r]/g,"").replace(/ {2,}/g," ").replace(/ *{ */g,"{").replace(/ *} */g,"}").replace(/[^{}]*?{}/g,"").replace(/[^{}]*?{[^{}]*?\:\;}/g,"").replace(/}/g,"}\n"):""},p=function(t){var o;return t=t||n("style#colorcustom"),o=t.html()},r=function(o){o=o||t||l()||p();var e=n("html").hasClass("lt-ie9");return f.length?e?(f.remove(),f=n('<style id="colorcustom" type="text/css" >'+o+"</style>").appendTo("head")):f.html(o):(f=e?n('<style id="colorcustom" type="text/css" >'+o+"</style>").appendTo("head"):n("<style />").attr("id","colorcustom").attr("type","text/css").html(o).appendTo("head"),a()),f},o=function(n){r(n)},s=function(){var n=i.find("input").data("selector");return n=n.replace(/\s+\{/,"{")},e=function(n){var t=s();if(!f.length)return!1;var o=c(n,t);try{r(o)}catch(e){}},c=function(t,o){var e,r,i,c,a,s;return e=o,e=e.replace(/\s+\{/,"{"),c=e.replace(/@color/,"(#\\w{3,6}|\\w*?|rgb\\([\\d\\, ]*?\\)|rgba\\([\\d\\, ]*?\\))").replace(/\./g,"\\.").replace(/\s+\{/,"{"),r=n("#colorcustom"),r.length?(s=r.html(),a=new RegExp("(\\s|^)"+c),i=r.html().match(a),t?i?s=s.replace(a,"\n"+e.replace(/@color/g,t)):s+="\n"+e.replace(/@color/g,t):i&&(s=s.replace(i,"")),s):!1},u=function(t){var o,e,r,i,c,a;return o=t,o=o.replace(/\s+\{/,"{"),i=o.replace(/@color/,"(#\\w{3,6}|\\w*?|rgb\\([\\d\\, ]*?\\)|rgba\\([\\d\\, ]*?\\))").replace(/\./g,"\\.").replace(/\s+\{/,"{"),e=n("#colorcustom"),e.length?(a=e.html(),c=new RegExp("(\\s|^)"+i),r=e.html().match(c),!!r&&!!r.length):!1},{add:r,set:o,change:e,isWriteTransparent:u}},p=function(){var t,o,e,r,c,a,p,f,c,d,v,h,b,g,m,k,$,x,y,C,T,w,I,F,R,j,H,P,A,q,B,D;return t={},o={},r=function(t){if("colorPicker"===t){var o=n(".box-colorpicker");e=n.extend(e,{$input:o.find(".con-1 .form-control-o-color"),$inputTransparent:o.find(".con-1 .form-control-o-transparent"),$checkboxTransparent:o.find(".con-3 input:checkbox"),$btnReset:o.find(".con-1 .btn-o-reset"),$btnSubmit:o.find(".con-1 .btn-o-submit"),$farbtastic:o.find(".con-2")})}else if("pop"===t){var r=a.data("bs.popover").$tip;e=n.extend(e,{$pop:r})}else e=n.extend(e,{$main:a,$mainInput:a.find("input"),$colorpicker:n()}),a=e.$main},p=function(n){a=n||a||i,a.data("bs.popover")?(r("colorPicker"),r("pop")):(r(),f(),h(),d())},f=function(){var n="bottom";a.attr("tabindex","0"),a.attr("title","颜色选取"),a.closest(".box-fixed-left").length&&(n="right"),a.popover({title:"颜色选取",trigger:"manual",placement:n,content:'<div class="con-tmp" style="width:195px;height:298px;"></div>',html:!0,viewport:{selector:"body",padding:0}})},c=function(){e.$main.popover("destroy")},d=function(){e.$main.popover("show")},v=function(){e.$pop.addClass("hide"),q(),e.$main.popover("hide")},b=function(t){t&&k(),e.$pop.addClass("hide"),q(),c(),n(document).off("click.colorpickerout")},g=function(){e.$pop.addClass("popover-colorpicker")},h=function(){a.on("show.bs.popover",D),a.on("shown.bs.popover",B),a.on("hide.bs.popover",function(){})},m=function(o,r){var i,c,a=function(){return c=+e.$inputTransparent.val(),i=!(1===c)},s=function(n,o){if("farbtastic"===n)u.isHexColor(o)?t.farbtasticObj.setColor(o):""===o?(a()&&(o="transparent"),m(o,["main","mainInput","style"]),m("",["input"])):m(o,["main","mainInput","style","input"]);else if("style"===n)l().change(o);else if("main"===n)e["$"+n].css("background",o);else{e["$"+n].val(o);var r=e["$"+n].eq(0),i=r.next(".txt-tips");i.length||(r.after('<div class="txt-tips"></div>'),i=r.next(".txt-tips")),i.html(o||"")}};u.isColor(o)&&(r?r instanceof Array?n.each(r,function(n,t){s(t,o)}):"string"==typeof r&&s(r,o):m(o,["farbtastic"]))},k=function(n){n=""===n?t.originColor:n||t.originColor,m(n,["farbtastic"])},I=function(){e.$input.off("keypress").on("keypress",function(){var t=n(this).val();m(t,["farbtastic"])}).off("change").on("change",function(){var t=n(this).val();m(t,["farbtastic"])}).off("keydown").on("keydown",function(){})},F=function(){e.$btnReset.off("click").on("click",function(){e.$input.val(t.originColor).prop("disabled",!1),e.$inputTransparent.val("1"),o.checkbox("uncheck"),k()}),e.$btnSubmit.off("click").on("click",function(){e.$mainInput.data("originColor")==e.$mainInput.val()||e.$pop.filter(":not(.in)").length||e.$mainInput.trigger("change"),b()});var o=e.$pop.find("input:checkbox");o.checkbox(),o.off("change").on("change",function(){n(this).is(":checked")?(o.checkbox("check"),e.$inputTransparent.val("0"),e.$input.val("").prop("disabled",!0),e.$input.trigger("change")):(o.checkbox("uncheck"),e.$inputTransparent.val("1"),e.$input.val("").prop("disabled",!1),e.$input.trigger("change"))})},C=function(){n(document).off("click.colorpickerout").on("click.colorpickerout",function(t){var o=n(t.target).closest(".box-colorpicker,.popover");o.length||b(!0)})},P=function(){return e.$colorpicker=e.$colorpicker,e.$colorpicker.length||(e.$colorpicker=n(".box-colorpicker").removeClass("hide")),e.$colorpicker},H=function(){var t=String()+'	<div class="box-colorpicker">		<div class="con-2"></div>		<div class="con-1"><span>输入色值 </span><input type="text" class="form-control form-control-o-color input-sm" /></div>		<div class="con-1 hide"><span>透明度 </span><input type="text" class="form-control form-control-o-transparent input-sm" value="1" /></div>		<div class="con-3"><label class="checkbox-custom"><input type="checkbox" class="" name="colorPickerIsTransparent"><i class="fa fa-fw fa-square-o"></i>无颜色</label></div>		<div class="con-1"><span class="btn btn-sm btn-link pull-left btn-o-reset">恢复默认</span><span class="btn btn-sm btn-style-4 btn-o-submit">确认</span><span class="btn btn-sm btn-style-1 hide">重置</span></div>	</div>';e.$colorpicker=n(t).appendTo("body")},A=function(){e.$colorpicker.appendTo(e.$pop.find(".popover-content")),e.$pop.find(".con-tmp").remove()},q=function(){e.$colorpicker.addClass("hide").appendTo("body")},x=function(){t.originColor&&(m(t.originColor,["farbtastic"]),e.$inputTransparent.val("1"),e.$input.prop("disabled",!1),e.$checkboxTransparent.checkbox("uncheck"))},R=function(){H(),r("colorPicker"),r("pop"),$(),g(),A(),w(),s().refreshCallback(T),x(),I(),F(),C()},j=function(){r("colorPicker"),r("pop"),$(),g(),A(),w(),s().refreshCallback(T),x(),I(),F(),C()},w=function(){t.farbtasticObj=t.farbtasticObj?s(e.$farbtastic).getFn():s(e.$farbtastic).create()},y=function(){return 0===+e.$inputTransparent.val()},T=function(n){y()||(m(n,["main","mainInput","style","input"]),e.$pop.find("input:checkbox").checkbox("uncheck"))},$=function(){var n,o=e.$mainInput;return n=o.val(),o.data("originColor",n||""),t.originColor=n,n},D=function(){},B=function(t){var o=n(t.target).data("bs.popover").$tip;if(o.length&&o.find(".box-colorpicker").length);else{var e=P();e.length?j():R()}},{init:p}},u={isColor:function(n){var t=!1;return""===n?t=!0:/^#[0-9a-fA-F]{3,6}$/.test(n)?t=!0:/^\w*?$/.test(n)?t=!0:/^rgb\(\d{1,3}\,\s+\d{1,3}\,\s+\d{1,3}\)$/.test(n)?t=!0:/^rgba\(\d{1,3}\,\s+\d{1,3}\,\s+\d{1,3}\,\s+([\d\.]{1,3})\)$/.test(n)&&(t=!0),t},isHexColor:function(n){return!!/^#[0-9a-fA-F]{3,6}$/.test(n)},RGBToHex:function(n){var t,o,e,r;t=/^rgba?\(([0-9]{0,3})\,\s([0-9]{0,3})\,\s([0-9]{0,3})(,\s([0-9\.]{0,4}))?\)/,o=n.replace(t,"$1 $2 $3 $5").split(" "),e="#",r=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];for(var i=0;3>i;i++){for(var c=null,a=o[i],s=[];a>16;)c=a%16,a=a/16>>0,s.push(r[c]);s.length||s.push("0"),s.push(r[a]),e+=s.reverse().join("")}return"0"===o[3]&&(e=""),e}},f=function(t){var o;o=i;var e,r;e=t||n("body"),r=e.find(".colorpicker"),r.each(function(){var t=n(this);a(t).setFn(!1)})},d=function(n){l().add(),f(n),v()},v=function(){var o;n(document).off("click.colorpicker").on("click.colorpicker",".colorpicker",function(){var e=n(this).find("input"),r=e.data("pickingColor");r&&e.val(r),o=new t({$main:n(this)}),o.popover().init()})};this.init=d,this.popover=p}return t}(),r=new e({});r.init(),t.colorpick_manage=r}(jQuery,window);